app.controller('FinancialCtrl', ['$http','$uibModal','$log','$scope','$document','userTemp',function($http,$uibModal, $log, $scope,$document,userTemp) {
    var selt = this;

    selt.mobileRegx = RegExp("^1(3[0-9]|4[57]|5[0-35-9]|7[01678]|8[0-9])\\d{8}$");
    selt.moneyReg = RegExp("^(([1-9]+)$|([0-9]+\.[0-9]{1,2})$)");

    $scope.selectDatas = [
        {
            "name":"安徽省",
            "list":[
                "安庆市",
                "蚌埠市",
                "池州市",
                "巢湖市",
                "滁州市",
                "阜阳市",
                "亳州市",
                "合肥市",
                "淮北市",
                "淮南市",
                "黄山市",
                "六安市",
                "马鞍山市",
                "宿州市",
                "铜陵市",
                "芜湖市",
                "宣城市"
            ]
        },
        {
            "name":"澳门特别行政区",
            "list":[

            ]
        },
        {
            "name":"北京市",
            "list":[
                "昌平区",
                "崇文区",
                "朝阳区",
                "东城区",
                "大兴区",
                "房山区",
                "丰台区",
                "海淀区",
                "怀柔区",
                "门头沟区",
                "密云县",
                "平谷区",
                "石景山区",
                "顺义区",
                "通州区",
                "西城区",
                "宣武区",
                "延庆县"
            ]
        },
        {
            "name":"重庆市",
            "list":[
                "北碚区",
                "璧山区",
                "巴南区",
                "城口县",
                "长寿区",
                "大渡口区",
                "垫江县",
                "大足区",
                "丰都县",
                "奉节县",
                "涪陵区",
                "合川市",
                "江北区",
                "江津市",
                "九龙坡区",
                "开州区",
                "梁平县",
                "南岸区",
                "南川区",
                "彭水县",
                "黔江区",
                "綦江县",
                "荣昌区",
                "石柱县",
                "沙坪坝区",
                "双桥区",
                "铜梁区",
                "潼南县",
                "武隆县",
                "万盛区",
                "巫山县",
                "巫溪县",
                "万州区",
                "秀山县",
                "渝北区",
                "永川市",
                "云阳县",
                "酉阳区",
                "渝中区",
                "忠县"
            ]
        },
        {
            "name":"福建省",
            "list":[
                "福州市",
                "龙岩市",
                "宁德市",
                "南平市",
                "莆田市",
                "泉州市",
                "三明市",
                "厦门市",
                "漳州市"
            ]
        },
        {
            "name":"广东省",
            "list":[
                "潮州市",
                "东莞市",
                "佛山市",
                "广州市",
                "惠州市",
                "河源市",
                "江门市",
                "揭阳市",
                "茂名市",
                "梅州市",
                "清远市",
                "韶关市",
                "深圳市",
                "汕头市",
                "汕尾市",
                "云浮市",
                "阳江市",
                "湛江市",
                "珠海市",
                "中山市",
                "肇庆市"
            ]
        },
        {
            "name":"甘肃省",
            "list":[
                "白银市",
                "定西市",
                "金昌市",
                "酒泉市",
                "嘉峪关市",
                "陇南市",
                "临夏回族自治州",
                "兰州市",
                "平凉市",
                "庆阳市",
                "天水市",
                "武威市",
                "张掖市"
            ]
        },
        {
            "name":"贵州省",
            "list":[
                "安顺市",
                "毕节地区",
                "贵阳市",
                "六盘水市",
                "铜仁地区",
                "遵义市"
            ]
        },
        {
            "name":"广西壮族自治区",
            "list":[
                "百色市",
                "北海市",
                "崇左市",
                "防城港市",
                "贵港市",
                "桂林市",
                "河池市",
                "贺州市",
                "来宾市",
                "柳州市",
                "南宁市",
                "钦州市",
                "梧州市",
                "玉林市"
            ]
        },
        {
            "name":"河北省",
            "list":[
                "保定市",
                "沧州市",
                "承德市",
                "邯郸市",
                "衡水市",
                "廊坊市",
                "秦皇岛市",
                "石家庄市",
                "唐山市",
                "邢台市",
                "张家口市"
            ]
        },
        {
            "name":"河南省",
            "list":[
                "安阳市",
                "鹤壁市",
                "焦作市",
                "开封市",
                "漯河市",
                "洛阳市",
                "南阳市",
                "平顶山市",
                "濮阳市",
                "商丘市",
                "三门峡市",
                "信阳市",
                "许昌市",
                "新乡市",
                "郑州市",
                "周口市",
                "驻马店市"
            ]
        },
        {
            "name":"黑龙江省",
            "list":[
                "大庆市",
                "大兴安岭地区",
                "哈尔滨市",
                "鹤岗市",
                "黑河市",
                "佳木斯市",
                "鸡西市",
                "牡丹江市",
                "齐齐哈尔市",
                "七台河市",
                "绥化市",
                "双鸭山市",
                "伊春市"
            ]
        },
        {
            "name":"海南省",
            "list":[
                "海口市",
                "三亚市"
            ]
        },
        {
            "name":"湖北省",
            "list":[
                "鄂州市",
                "黄石市",
                "黄冈市",
                "荆门市",
                "荆州市",
                "十堰市",
                "随州市",
                "武汉市",
                "襄阳市",
                "咸宁市",
                "孝感市",
                "宜昌市"
            ]
        },
        {
            "name":"湖南省",
            "list":[
                "常德市",
                "长沙市",
                "郴州市",
                "怀化市",
                "衡阳市",
                "娄底市",
                "邵阳市",
                "湘西土家族苗族自治州",
                "湘潭市",
                "益阳市",
                "岳阳市",
                "永州市",
                "张家界市",
                "株洲市"
            ]
        },
        {
            "name":"江苏省",
            "list":[
                "常州市",
                "淮安市",
                "连云港市",
                "南京市",
                "南通市",
                "宿迁市",
                "苏州市",
                "泰州市",
                "无锡市",
                "徐州市",
                "盐城市",
                "扬州市",
                "镇江市"
            ]
        },
        {
            "name":"江西省",
            "list":[
                "抚州市",
                "赣州市",
                "吉安市",
                "景德镇市",
                "九江市",
                "南昌市",
                "萍乡市",
                "上饶市",
                "新余市",
                "宜春市",
                "鹰潭市"
            ]
        },
        {
            "name":"吉林省",
            "list":[
                "白城市",
                "白山市",
                "长春市",
                "吉林市",
                "辽源市",
                "松原市",
                "四平市",
                "通化市",
                "延边朝鲜族自治州"
            ]
        },
        {
            "name":"辽宁省",
            "list":[
                "鞍山市",
                "本溪市",
                "朝阳市",
                "丹东市",
                "大连市",
                "抚顺市",
                "阜新市",
                "葫芦岛市",
                "锦州市",
                "辽阳市",
                "盘锦市",
                "沈阳市",
                "铁岭市",
                "营口市"
            ]
        },
        {
            "name":"内蒙古自治区",
            "list":[
                "阿拉善盟",
                "包头市",
                "巴彦淖尔市",
                "赤峰市",
                "鄂尔多斯市",
                "呼和浩特市",
                "呼伦贝尔市",
                "通辽市",
                "乌海市",
                "乌兰察布市",
                "兴安盟",
                "锡林郭勒盟"
            ]
        },
        {
            "name":"宁夏回族自治区",
            "list":[
                "固原市",
                "石嘴山市",
                "吴忠市",
                "银川市",
                "中卫市"
            ]
        },
        {
            "name":"青海省",
            "list":[
                "果洛藏族自治州",
                "海北藏族自治州",
                "海东地区",
                "黄南藏族自治州",
                "海南藏族自治州",
                "西宁市",
                "玉树藏族自治州"
            ]
        },
        {
            "name":"四川省",
            "list":[
                "巴中市",
                "成都市",
                "德阳市",
                "达州市",
                "广安市",
                "广元市",
                "泸州市",
                "乐山市",
                "眉山市",
                "绵阳市",
                "南充市",
                "内江市",
                "攀枝花市",
                "遂宁市",
                "雅安市",
                "宜宾市",
                "自贡市",
                "资阳市"
            ]
        },
        {
            "name":"山东省",
            "list":[
                "滨州市",
                "德州市",
                "东营市",
                "菏泽市",
                "济宁市",
                "济南市",
                "聊城市",
                "临沂市",
                "临清市",
                "莱芜市",
                "青岛市",
                "日照市",
                "泰安市",
                "威海市",
                "潍坊市",
                "烟台市",
                "枣庄市",
                "淄博市"
            ]
        },
        {
            "name":"上海市",
            "list":[
                "宝山区",
                "崇明县",
                "长宁区",
                "奉贤区",
                "虹口区",
                "黄浦区",
                "静安区",
                "嘉定区",
                "金山区",
                "卢湾区",
                "闵行区",
                "南汇区",
                "浦东新区",
                "普陀区",
                "青浦区",
                "松江区",
                "徐汇区",
                "杨浦区",
                "闸北区"
            ]
        },
        {
            "name":"山西省",
            "list":[
                "长治市",
                "大同市",
                "晋城市",
                "晋中市",
                "临汾市",
                "吕梁市",
                "朔州市",
                "太原市",
                "忻州市",
                "阳泉市",
                "运城市"
            ]
        },
        {
            "name":"陕西省",
            "list":[
                "安康市",
                "宝鸡市",
                "汉中市",
                "商洛市",
                "铜川市",
                "渭南市",
                "西安市",
                "咸阳市",
                "延安市",
                "榆林市"
            ]
        },
        {
            "name":"天津市",
            "list":[
                "北辰区",
                "宝坻区",
                "大港区",
                "东丽区",
                "河北区",
                "河东区",
                "汉沽区",
                "和平区",
                "红桥区",
                "河西区",
                "静海县",
                "津南区",
                "蓟县",
                "宁河县",
                "南开区",
                "塘沽区",
                "武清区",
                "西青区"
            ]
        },
        {
            "name":"台湾省",
            "list":[

            ]
        },
        {
            "name":"香港特别行政区",
            "list":[

            ]
        },
        {
            "name":"新疆维吾尔自治区",
            "list":[
                "博尔塔拉蒙古自治州",
                "昌吉回族自治州",
                "哈密地区",
                "和田地区",
                "克拉玛依市",
                "喀什地区",
                "克孜勒苏柯尔克孜自治州",
                "吐鲁番地区",
                "乌鲁木齐市",
                "伊犁哈萨克自治州"
            ]
        },
        {
            "name":"西藏自治区",
            "list":[
                "阿里地区",
                "昌都地区",
                "拉萨市",
                "林芝地区",
                "那曲地区",
                "日喀则地区",
                "山南地区"
            ]
        },
        {
            "name":"云南省",
            "list":[
                "保山市",
                "德宏州",
                "昆明市",
                "临沧市",
                "丽江市",
                "普洱市",
                "曲靖市",
                "思茅市",
                "玉溪市",
                "昭通市"
            ]
        },
        {
            "name":"浙江省",
            "list":[
                "杭州市",
                "湖州市",
                "金华市",
                "嘉兴市",
                "丽水市",
                "宁波市",
                "衢州市",
                "绍兴市",
                "台州市",
                "温州市",
                "舟山市"
            ]
        }
    ];

    this.changeProvince = function () {

    }

    this.changeCity = function () {

    }

    var regDateTime = /^(?:19|20)[0-9][0-9]-(?:(?:0[1-9])|(?:1[0-2]))-(?:(?:[0-2][1-9])|(?:[1-3][0-1])) (?:(?:[0-2][0-3])|(?:[0-1][0-9])):[0-5][0-9]:[0-5][0-9]$/;

    this.submit = function (valid) {
        if (null != userTemp) {
            var region = '';
            var province = selt.province;
            var city = selt.city;
            var projName = selt.projName;
            var kbTime = document.getElementById("kbTime").value;
            var borrower = selt.borrower;
            var phone = selt.phone;
            var borrowTime = document.getElementById("borrowTime").value;
            var money = selt.money;
            if (undefined == province) {
                alert('请选择省份！');
                return;
            } else {
                region = angular.fromJson(province).name;
                if (undefined != city) {
                    region = region + city;
                }
            }
            if ('' == kbTime || kbTime == undefined) {
                alert('开标时间不能为空！');
                return;
            } else {
                if (!regDateTime.test(kbTime)) {
                    alert('开标时间格式不正确！正确格式为 2018-01-01 00:00:00');
                    selt.kbTime='';
                    return;
                }
            }
            if ('' == borrowTime || borrowTime == undefined) {
                alert('借款时间不能为空！');
                return;
            } else {
                if (!regDateTime.test(borrowTime)) {
                    alert('借款时间格式不正确！正确格式为 2018-01-01 00:00:00');
                    selt.borrowTime = '';
                    return;
                }
            }
            var params = {
                region: region,
                projName: projName,
                borrower: borrower,
                borrowTime: borrowTime,
                kbTime: kbTime,
                phone: phone,
                money: money
            };
            if (valid) {
                $http.post("/foundation/borrow", angular.toJson(params)).success(function (result) {
                    if (result.code == 1) {
                        alert('申请保证金借款成功！');
                        selt.projName = '';
                        selt.borrower = '';
                        selt.borrowTime = '';
                        selt.kbTime = '';
                        selt.phone = '';
                        selt.money = '';
                    } else {
                        alert('申请保证金借款失败！');
                    }
                });
            }
        } else {
            alert('您未登录，暂不能申请保证金借款！');
        }
    }
}]);